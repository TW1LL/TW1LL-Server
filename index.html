<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>

</head>
<body>
    <ul id="users"></ul>
    <hr>
    <ul id="messages"></ul>
    <input type="text" id="sendTo">
    <input type="text" id="message"/>
    <input type="hidden" id="sendToId">
    <button id="submit">Submit</button>
    <script src="/socket.io/socket.io.js"></script>
    <script>
        let user = {};
        let users = {};

        let socket = io();
        addEventListener("load", function(){
            socket.emit("identifier", "bogus identifier");
        });
        addEventListener("DOMContentLoaded", function(){
            document.getElementById("submit").addEventListener("click", sendMsg);
            let userList = document.getElementsByClassName("sendTo");
            for(let i = 0; i < userList.length; i++) {
                userList[i].addEventListener("click", sendTo);
            }
        });

        function sendTo(event) {
            console.log(document.getElementById("sendTo").value);
            console.log(event);
            document.getElementById("sendTo").value = event.target.innerText;
            document.getElementById("sendToId").value = event.target.id;
        }
        function sendMsg(){
            let textbox = document.getElementById("message");
            let to = document.getElementById("sendToId").value;

            let message = {
                to: to,
                text: textbox.value

            };
            socket.emit("message send", message);
            textbox.value = "";
            let li = document.createElement("li");
            let text = document.createTextNode("<" + user.name + "> " + message.text);
            li.appendChild(text);
        }
        socket.on("user data", function(user) {
            user = user;
            console.log(user);
        });
        socket.on("user new", function(user) {
            users[user.id] = user;
            let li = document.createElement("li");
            li.innerHTML = '<a href="#" class="user" id="'+user.id+'">' + user.name + '</a>';
            li.addEventListener("click", sendTo);
            document.getElementById("users").appendChild(li);


        });
        socket.on("message receive", function(message) {
            let li = document.createElement("li");
            let text = document.createTextNode("<" + message.from + "> " + message.text);
            li.appendChild(text);
            document.getElementById("messages").appendChild(li);
        });

    </script>
</body>
</html>
