<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>

</head>
<body>
    <ul id="users"></ul>
    <hr>
    <ul id="messages"></ul>
    <input type="text" id="sendTo">
    <input type="text" id="message"/>
    <button id="submit">Submit</button>
    <script src="/socket.io/socket.io.js"></script>
    <script>
        let user = {};
        let users = {};

        let socket = io();
        addEventListener("load", function(){
            socket.emit("identifier", "bogus identifier");
        });
        addEventListener("DOMContentLoaded", function(){
            document.getElementById("submit").addEventListener("click", sendMsg);
            let userList = document.getElementsByClassName("sendTo");
            for(let i in userList) {
                userList[i].addEventListener("click", sendTo);
            }
        });

        function sendTo(event) {
            document.getElementById("sendTo").value;
        }
        function sendMsg(){
            let textbox = document.getElementById("message");
            let text = textbox.value;
            let to_box = document.getElementById("sendTo");
            let to = to_box.value;
            let message = {
                "to" : to,
                "from" : user.id,
                "text" : text,
                "id" : "",
                "timestamp" : Date.now()
            };
            socket.emit("message send", message);
            textbox.value = "";
            to_box.value = "";
            let li = document.createElement("li");
            let new_message = document.createTextNode("<" + user.name + "> " + message.text);
            li.appendChild(new_message);
        }
        socket.on("user data", function(assigned_user) {
            user = assigned_user;
            console.log(assigned_user);
        });
        socket.on("user new", function(user) {
            users[user.id] = user;
            let li = document.createElement("li");
            li.setAttribute("id", user.id);
            li.innerHTML = '<a href="#" class="user">' + user.name + '</a>';
            document.getElementById("users").appendChild(li);

        });
        socket.on("message receive", function(message) {
            let li = document.createElement("li");
            let text = document.createTextNode("<" + message.from + "> " + message.text);
            li.appendChild(text);
            document.getElementById("messages").appendChild(li);
        });
    </script>
</body>
</html>
